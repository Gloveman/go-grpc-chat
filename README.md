# Go-gRPC 실시간 채팅 서버 

### 우아한테크코스 8기 오픈미션
 Go 언어와 gRPC를 사용하여 고성능 실시간 채팅 서버와 대화를 나눌 수 있는 간단한 클라이언트를 구현합니다. 대화방을 나눌 수 있으며, 특정 사람과 다이렉트 메시지 역시 가능합니다. 

---
## 프로젝트 동기
 프리 미션의 예시에서 '낯선 도구 해커톤'과 '고난도 문제 해커톤'을 합쳐, 사용해 본 적 없는 Go 언어를 통해 난이도 높은 문제를 해결하고자 했습니다. 주제를 고민하다 문득 카카오톡이 떠올라, 실시간 채팅 기능을 만들어 보기로 정했습니다. 기존의 JSON과 Websocket을 사용하는 방식을 벗어나, protobuf의 binary 프로토콜을 활용하고 gRPC 스트리밍을 통해 카카오톡처럼 텍스트 뿐만 아니라 빠른 파일 전송까지 구현하는 것이 최종 목표입니다.

---
## 실행 방법
#### 1. 실행 파일 다운로드
최신 릴리스 페이지에서 **`server.exe`**와 **`client.exe`**를 다운로드하세요.

##### 👉 **[다운로드 페이지](https://github.com/Gloveman/go-grpc-chat/releases/latest)**
#### 2. 서버 실행 (호스트)
채팅방을 개설할 컴퓨터에서 서버를 먼저 실행합니다.
1. `server.exe`를 더블 클릭하거나 터미널에서 실행합니다.
2. 방화벽 경고가 뜨면 "액세스 허용"을 눌러주세요.
3. `gRPC Server started on port :50051` 메시지가 뜨면 성공입니다.

#### 3. 클라이언트 실행 (참여자)
채팅에 참여할 컴퓨터(들)에서 클라이언트를 실행합니다.
1. `client.exe`를 더블 클릭하거나 터미널에서 실행합니다.
2. 서버가 켜진 컴퓨터의 IP를 입력합니다. (기본값 `localhost`)
3. 사용할 닉네임을 입력합니다.
4. 채팅 로비에 접속했습니다!
---

### 프로그램 기능 소개

클라이언트를 실행하면 먼저 **로비(Lobby)**에 접속하게 되며, 방을 생성하거나 입장한 후에는 **채팅방(Room)** 모드로 전환됩니다. 각 상황에서 사용할 수 있는 명령어는 다음과 같습니다.

#### 로비 (Lobby)
서버 접속 후 대기 상태입니다. 방을 만들거나, DM을 보내거나, 전체 유저를 조회할 수 있습니다.

| 명령어 | 설명 | 사용 예시 |
| :--- | :--- | :--- |
| **`create [방이름]`** | 새로운 채팅방을 생성하고 즉시 입장합니다. | `create Go스터디` |
| **`join [방번호]`** | 방 목록에 있는 번호(ID)를 입력해 입장합니다. | `join 1` |
| **`list`** | 현재 생성된 모든 채팅방 목록을 새로고침합니다. | `list` |
| **`/w [유저] [메시지]`** | 특정 유저에게 귓속말(DM)을 보냅니다. | `/w pobi 안녕하세요` |
| **`/wfile [유저]`** | 특정 유저에게 귓속말(DM)로 파일을 전송합니다. | `/wfile pobi` |
| **`/download [ID]`** | `fileId`에 해당하는 파일을 다운로드합니다. | `/download abc_123` |
| **`users`** | 현재 서버에 접속한 **모든** 유저 목록을 보여줍니다. | `users` |
| **`files`** | 수신된 파일 목록을 확인합니다. | `files` |
| **`help`** | 도움말을 출력합니다. | `help` |
| **`quit`** | 프로그램을 완전히 종료합니다. | `quit` |

<br>

#### 💬 채팅방 (Chat Room)
특정 방에 입장한 상태입니다. 입력하는 모든 텍스트는 기본적으로 방 전체에 메시지로 전송됩니다.

| 명령어 | 설명 | 사용 예시 |
| :--- | :--- | :--- |
| **`/quit`** | 현재 방에서 퇴장하여 로비로 돌아갑니다. | `/quit` |
| **`/upload`** | 현재 방의 모든 인원에게 파일을 전송합니다. | `/upload` |
| **`/w [유저] [메시지]`** | 특정 유저에게 귓속말을 보냅니다. | `/w pobi ㅎㅇ` |
| **`/wfile [유저]`** | 특정 유저에게 파일을 보냅니다. | `/wfile pobi` |
| **`/download [ID]`** | 공유된 파일을 다운로드합니다. | `/download xyz_999` |
| **`/roomusers`** | **현재 방에 참여 중인** 유저 목록을 보여줍니다. | `/roomusers` |
| **`/users`** | 서버 전체 접속 유저 목록을 보여줍니다. | `/users` |
| **`/files`** | 수신된 파일 목록을 확인합니다. | `/files` |
| **`/help`** | 채팅방 전용 도움말을 출력합니다. | `/help` |

---

### #💡 파일 전송 팁
* `/upload` 또는 `/wfile` 명령어를 입력하면, **파일 탐색기(File Dialog)** 창이 열립니다.
* 전송할 파일을 선택하면 자동으로 업로드가 시작됩니다.
* 상대방에게는 `[파일 전송됨: file_id]` 형태의 메시지가 표시됩니다.
---
### ✅ 구현 기능 체크리스트
#### 0단계: 프로젝트 기본 환경 설정
* [x] Go 언어 개발 환경 설치
* [x] protobuf 컴파일러 설치
* [x] go.mod 파일 생성
* [x] gRPC 라이브러리 설치
* [x] go용 protoc 플러그인 설치
* [x] .gitignore 파일 작성

#### 1단계: 실시간 채팅 구현 (참여자 전원에게 브로드캐스팅)

가장 기본적인 실시간 채팅 기능을 구현합니다. 
* [x] gRPC 서버 및 클라이언트 기본 골격 설정
* [x] Protobuf를 사용한 `ChatService` API 정의
* [x] `JoinRoom` RPC 구현
    * [x] 접속 시 `username` 설정 기능
    * [x] 서버가 클라이언트의 스트림을 관리 (단일 방)
* [x] `SendMessage` RPC 구현
    * [x] 메시지를 받아 `[username]: message` 형식으로 포맷팅
    * [x] 방에 있는 **모든** 클라이언트에게 메시지 방송(Broadcast)
* [x] Server main 함수 작성
* [x] 클라이언트 코드 
#### 2단계: 개별 채팅방 구현
사용자가 여러 개의 독립된 방을 생성, 방 목록 조회 및 선택한 방에 입장할 수 있도록 확장합니다.
* [x] API 정의 수정
   * [x] 방 정보를 담은 Message 추가
   * [x] JoinRequest에 방 번호와 방 이름 필드 추가
   * [x] 방 목록을 조회하는 GetRoomsInfo RPC 추가
* [x] 서버 구현
    * [x] clients 맵 수정 - Room 별로 클라이언트 스트림 관리
    * [x] JoinRoom 로직 수정 - 선택한 방으로 입장, 요청 시 새로운 방 생성
    * [x] SendMessage 로직 수정 - 해당 방으로만 broadcast
    * [x] GetRoomsInfo 구현 - 각 방 이름과 참여 인원 수 반환
* [x] 클라이언트 구현
    * [x] '로비' 추가 (main 진입점) - 방 목록 표시, 방 입장 or 새로운 방 생성, 닉네임 변경 구현
    * [x] 채팅 세션 분리

#### 3단계: 다이렉트 메시지 기능

특정 클라이언트 간의 1:1 메시지(DM) 기능을 추가합니다.
* [x] API 정의 수정
   * [x] 로비 서버 (global 서버) 접속 및 DM 수신을 위한 RPC 추가
   * [x] 유저 리스트 조회 RPC 추가
   * [x] ChatMesssage에 DM 전송 상대방 닉네임 필드 추가   
* [x] 서버 구현
    * [x] 입력한 닉네임이 서버에 존재하는지 검사
    * [x] DM 전송 기능 추가
    * [x] 서버 전체 유저 리스트/참여 방 유저 리스트 조회 추가
* [x] 클라이언트 구현
    * [x] DM 수신을 위한 goroutine 추가
    * [x] 유저 조회 추가
    * [x] DM 명령어, 유저 리스트 조회 명령어 추가

#### 4단계: 파일 전송 (gRPC 스트리밍)

텍스트를 넘어 이미지 등의 바이너리 파일을 전송하는 기능을 구현합니다.
* [x] API 정의 수정
   * [x] 파일 보내기/다운받기 RPC 추가
   * [x] 파일 메타데이터 Message 추가
   * [x] 업로드/다운로드 상태 관리 Message 추가   
   * [x] ChatMessage에 파일 정보 필드 추가
* [x] 서버 구현
    * [x] chunk 단위 파일 업로드, 다운로드 처리 - 파일 크기 제한
    * [x] 다운로드 시 권한 있는 사용자인지 확인(보낸 사람과 같은 방 or DM으로 받음)
    * [x] 업로드 실패 시 서버 내 파일 삭제
* [x] 클라이언트 구현
    * [x] 탐색기 dialog를 통한 파일 선택 후 업로드 기능
    * [x] 서버 접속 중에 받았던 파일 리스트 확인 기능 
    * [x] dialog로 지정한 경로에 파일 다운로드 기능
* [x] 최종 테스트
    * 서버 접속 시
        * [x] 중복 닉네임인 경우 닉네임 다시 입력
        * [x] 잘못된 서버 입력 시 서버 다시 입력
    * 채팅방 생성, 목록 조회
        * [x] 방 생성 후 다른 클라이언트 해당 방 조회
        * [x] 방 입장 시 메시지 표시
        * [x] 방에 아무도 없는 경우 해당 방 자동 삭제
        * [x] 현재 방에 있는 유저 목록 조회
        * [x] 전체 유저 목록 조회
    * 채팅 및 DM 테스트
        * [x] 채팅방에 있는 모든 유저에게 내 채팅 표시
        * [x] 해당 채팅방에 없는 유저에게는 표시 X
        * [z] DM 보낸 상대방에게 메시지 표시(로비, 채팅방 모두)
        * [z] DM 상대방이 아닌 경우 표시 X
    * 파일 전송 테스트
        * [x] 채팅방 및 DM에 파일 전송 명령어 입력 시 파일 선택 창 표시 
        * [x] 업로드 완료 시 상대방에게 파일 정보 메시지 표시
        * [x] 본인이 받았던 파일 목록 조회
        * [x] 파일 다운로드 시 경로 선택 창 표시
        * [x] 다운로드 된 파일 확인
    * 예외 처리 및 서버 연결 관리
        * [x] 1GB 이상 파일 전송 시도 시 오류 메시지 표시
        * [x] 클라이언트 종료 시 서버에 연결 끊김, 퇴장 처리 로그 표시
        * [x] 채팅방 내의 다른 유저가 나간 경우 남은 사람에게 퇴장 메시지 표시
        * [x] 채팅방 접속 중 서버 종료 시 자동 연결 종료
* [x] 릴리즈 배포
* [x] 프로그램 실행 방법, 기능 소개 작성