# Go-gRPC 실시간 채팅 서버 

### 우아한테크코스 8기 오픈미션
 Go 언어와 gRPC를 사용하여 고성능 실시간 채팅 서버와 대화를 나눌 수 있는 간단한 클라이언트를 구현합니다. 대화방을 나눌 수 있으며, 특정 사람과 다이렉트 메시지 역시 가능합니다. 

---
## 프로젝트 동기
 프리 미션의 예시에서 '낯선 도구 해커톤'과 '고난도 문제 해커톤'을 합쳐, 사용해 본 적 없는 Go 언어를 통해 난이도 높은 문제를 해결하고자 했습니다. 주제를 고민하다 문득 카카오톡이 떠올라, 실시간 채팅 기능을 만들어 보기로 정했습니다. 기존의 JSON과 Websocket을 사용하는 방식을 벗어나, protobuf의 binary 프로토콜을 활용하고 gRPC 스트리밍을 통해 카카오톡처럼 텍스트 뿐만 아니라 빠른 파일 전송까지 구현하는 것이 최종 목표입니다.

---
## 실행 방법

---
### ✅ 구현 기능 체크리스트
#### 0단계: 프로젝트 기본 환경 설정
* [x] Go 언어 개발 환경 설치
* [x] protobuf 컴파일러 설치
* [x] go.mod 파일 생성
* [x] gRPC 라이브러리 설치
* [x] go용 protoc 플러그인 설치
* [x] .gitignore 파일 작성

#### 1단계: 실시간 채팅 구현 (참여자 전원에게 브로드캐스팅)

가장 기본적인 실시간 채팅 기능을 구현합니다. 
* [x] gRPC 서버 및 클라이언트 기본 골격 설정
* [x] Protobuf를 사용한 `ChatService` API 정의
* [x] `JoinRoom` RPC 구현
    * [x] 접속 시 `username` 설정 기능
    * [x] 서버가 클라이언트의 스트림을 관리 (단일 방)
* [x] `SendMessage` RPC 구현
    * [x] 메시지를 받아 `[username]: message` 형식으로 포맷팅
    * [x] 방에 있는 **모든** 클라이언트에게 메시지 방송(Broadcast)
* [x] Server main 함수 작성
* [x] 클라이언트 코드 
#### 2단계: 개별 채팅방 구현
사용자가 여러 개의 독립된 방을 생성, 방 목록 조회 및 선택한 방에 입장할 수 있도록 확장합니다.
* [x] API 정의 수정
   * [x] 방 정보를 담은 Message 추가
   * [x] JoinRequest에 방 번호와 방 이름 필드 추가
   * [x] 방 목록을 조회하는 GetRoomsInfo RPC 추가
* [x] 서버 구현
    * [x] clients 맵 수정 - Room 별로 클라이언트 스트림 관리
    * [x] JoinRoom 로직 수정 - 선택한 방으로 입장, 요청 시 새로운 방 생성
    * [x] SendMessage 로직 수정 - 해당 방으로만 broadcast
    * [x] GetRoomsInfo 구현 - 각 방 이름과 참여 인원 수 반환
* [x] 클라이언트 구현
    * [x] '로비' 추가 (main 진입점) - 방 목록 표시, 방 입장 or 새로운 방 생성, 닉네임 변경 구현
    * [x] 채팅 세션 분리

#### 3단계: 다이렉트 메시지 기능

특정 클라이언트 간의 1:1 메시지(DM) 기능을 추가합니다.
* [x] API 정의 수정
   * [x] 로비 서버 (global 서버) 접속 및 DM 수신을 위한 RPC 추가
   * [x] 유저 리스트 조회 RPC 추가
   * [x] ChatMesssage에 DM 전송 상대방 닉네임 필드 추가   
* [x] 서버 구현
    * [x] 입력한 닉네임이 서버에 존재하는지 검사
    * [x] DM 전송 기능 추가
    * [x] 서버 전체 유저 리스트/참여 방 유저 리스트 조회 추가
* [x] 클라이언트 구현
    * [x] DM 수신을 위한 goroutine 추가
    * [x] 유저 조회 추가
    * [x] DM 명령어, 유저 리스트 조회 명령어 추가

#### 4단계: 파일 전송 (gRPC 스트리밍)

텍스트를 넘어 이미지 등의 바이너리 파일을 전송하는 기능을 구현합니다.
* [x] API 정의 수정
   * [x] 파일 보내기/다운받기 RPC 추가
   * [x] 파일 메타데이터 Message 추가
   * [x] 업로드/다운로드 상태 관리 Message 추가   
   * [x] ChatMessage에 파일 정보 필드 추가
* [x] 서버 구현
    * [x] chunk 단위 파일 업로드, 다운로드 처리 - 파일 크기 제한
    * [x] 다운로드 시 권한 있는 사용자인지 확인(보낸 사람과 같은 방 or DM으로 받음)
    * [x] 업로드 실패 시 서버 내 파일 삭제
* [x] 클라이언트 구현
    * [x] 탐색기 dialog를 통한 파일 선택 후 업로드 기능
    * [x] 서버 접속 중에 받았던 파일 리스트 확인 기능 
    * [x] dialog로 지정한 경로에 파일 다운로드 기능
* [x] 최종 테스트
    * 서버 접속 시
        * [x] 중복 닉네임인 경우 닉네임 다시 입력
        * [x] 잘못된 서버 입력 시 서버 다시 입력
    * 채팅방 생성, 목록 조회
        * [x] 방 생성 후 다른 클라이언트 해당 방 조회
        * [x] 방 입장 시 메시지 표시
        * [x] 방에 아무도 없는 경우 해당 방 자동 삭제
        * [x] 현재 방에 있는 유저 목록 조회
        * [x] 전체 유저 목록 조회
    * 채팅 및 DM 테스트
        * [x] 채팅방에 있는 모든 유저에게 내 채팅 표시
        * [x] 해당 채팅방에 없는 유저에게는 표시 X
        * [z] DM 보낸 상대방에게 메시지 표시(로비, 채팅방 모두)
        * [z] DM 상대방이 아닌 경우 표시 X
    * 파일 전송 테스트
        * [x] 채팅방 및 DM에 파일 전송 명령어 입력 시 파일 선택 창 표시 
        * [x] 업로드 완료 시 상대방에게 파일 정보 메시지 표시
        * [x] 본인이 받았던 파일 목록 조회
        * [x] 파일 다운로드 시 경로 선택 창 표시
        * [x] 다운로드 된 파일 확인
    * 예외 처리 및 서버 연결 관리
        * [x] 1GB 이상 파일 전송 시도 시 오류 메시지 표시
        * [x] 클라이언트 종료 시 서버에 연결 끊김, 퇴장 처리 로그 표시
        * [x] 채팅방 내의 다른 유저가 나간 경우 남은 사람에게 퇴장 메시지 표시
        * [x] 채팅방 접속 중 서버 종료 시 자동 연결 종료
* [ ] 릴리즈 배포
* [ ] 프로그램 실행 방법 작성