syntax = "proto3";

package chat;
option go_package="github.com/Gloveman/go-grpc-chat/chatpb";

service ChatService {
    //Global 서버 접속 & DM 수신
    rpc Connect(ConnectRequest) returns (ChatMessage);

    //로비: 방 목록 조회 & 전체 유저 리스트 조회
    rpc GetRoomsInfo(RoomsInfoRequest) returns (RoomsInfoResponse);
    rpc GetAllUsers(AllUsersRequest) returns (AllUsersResponse);

    // 채팅방: 방 입장 & 방 내부 유저 리스트 조회
    rpc JoinRoom(JoinRequest) returns (stream ChatMessage);
    rpc GetRoomUsers(RoomUsersRequest) returns (RoomUsersRequest);
    // 메시지 전송 - 메시지 전송 및 전송 결과 반환
    rpc SendMessage(ChatMessage) returns (SendResponse);
}

message ConnectRequest {
    string user_name = 1;
}


message RoomInfo {
    int32 room_id = 1;
    string room_name = 2;
    int32 client_count = 3;
}
message RoomsInfoRequest {
    //방 필터링 시 파라미터 추가
}
message RoomsInfoResponse {
    repeated RoomInfo rooms = 1;
}

message UserInfo {
    string user_name=1;
}
message AllUsersRequest {
}
message AllUsersResponse {
    repeated UserInfo users = 1;
}
message RoomUsersRequest {
}


message JoinRequest {
    string user_name = 1;
    int32 room_id = 2;
    string room_name = 3;
}

message ChatMessage {
    string message_text = 1;
    string sender_user_name = 10;
    string sender_user_id = 11;
    int32 room_id = 20;
    string target_user_id = 21; //DM용
}
message SendResponse {
    bool success = 1;
}

